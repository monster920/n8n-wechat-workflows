# n8n 微信公众号内容自动化工作流

简体中文 | [English](./docs/en/README.md)

一套基于 n8n 的微信公众号内容自动化生成 pipeline，实现从内容生成、图片生成到排版发布的全流程自动化。

![工作流数量](https://img.shields.io/badge/工作流数量-7+-green)
![n8n 版本](https://img.shields.io/badge/n8n-1.0+-blue)
![License](https://img.shields.io/badge/License-MIT-yellow)

## ✨ 功能特性

- **内容自动生成**: 使用 DeepSeek AI 自动生成高质量公众号文章
- **智能配图**: 阿里云通义万相生成封面图和文章配图
- **自动排版**: 微信公众号格式自动排版
- **一键发布**: 自动上传至微信公众号草稿箱
- **飞书集成**: 飞书多维表格作为数据存储和管理

## 📁 项目结构

```
n8n-wechat-workflows/
├── workflows/                    # n8n 工作流文件
│   ├── 01_内容生成.n8n          # 内容生成工作流
│   ├── 02_图片生成.n8n          # 图片生成工作流
│   ├── 03_排版.n8n             # 排版工作流
│   ├── 04_标题内容处理.n8n      # 标题内容处理
│   ├── 05_排版图片生成.n8n     # 排版图片生成
│   ├── 06_排版图片内容处理.n8n  # 排版图片内容处理
│   └── 07_上传至微信草稿.n8n   # 上传至微信草稿
├── docs/                        # 文档
│   ├── README.md                # 技术文档
│   └── en/
│       └── README.md            # English Documentation
├── workflows-backup/            # 备份的工作流（可选）
├── .gitignore
├── README.md                    # 本文件
└── LICENSE                      # MIT 许可证
```

## 🔄 工作流架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         数据源：飞书多维表格                          │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  01_内容生成     │───▶│  02_图片生成     │───▶│  03_排版        │
│  DeepSeek AI    │    │  通义万相        │    │  微信格式排版   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
        │                                            │
        │           ┌─────────────────┐              │
        │           │  04_标题内容处理  │              │
        │           └────────┬────────┘              │
        │                    │                       │
        ▼                    ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  05_排版图片生成 │◀───│  06_排版图片内容  │◀───│  最终输出       │
│  封面图生成      │    │  处理            │    │                 │
└─────────────────┘    └─────────────────┘    │
        │                                        │
        └──────────────┬───────────────────────┘
                       ▼
              ┌─────────────────┐
              │  07_上传至微信   │
              │  公众号草稿箱    │
              └─────────────────┘
```

## 🚀 快速开始

### 前置要求

- n8n 服务 (v1.0+)
- 飞书开发者账号
- 微信公众号账号
- 阿里云账号 (通义万相 API)
- DeepSeek API Key

### 配置步骤

#### 1. 克隆项目

```bash
git clone https://github.com/your-username/n8n-wechat-workflows.git
cd n8n-wechat-workflows
```

#### 2. 导入工作流

在 n8n 界面中：
1. 点击 "Workflows" → "Import from File"
2. 选择 `workflows/` 目录下的 `.n8n` 文件
3. 依次导入所有工作流

#### 3. 配置凭证

需要配置以下凭证：

| 凭证名称 | 服务商 | 获取方式 |
|---------|--------|---------|
| Feishu API | 飞书 | [飞书开放平台](https://open.feishu.cn/) |
| DeepSeek | DeepSeek | [DeepSeek API](https://platform.deepseek.com/) |
| DashScope | 阿里云 | [阿里云 DashScope](https://dashscope.aliyuncs.com/) |
| WeChat API | 微信公众号 | [微信公众平台](https://mp.weixin.qq.com/) |

#### 4. 配置工作流参数

在每个工作流中修改以下参数：

```javascript
// 在 "设置参数" 节点中修改
{
  "飞书token": "你的飞书多维表格Token",
  "多维表格ID": "你的多维表格ID",
  "viewID": "你的视图ID"
}
```

#### 5. 启动工作流

1. 激活所有工作流
2. 通过 webhook 或定时触发启动

## 📋 工作流详情

### 01_内容生成

**功能**: 使用 DeepSeek AI 根据输入主题生成完整的公众号文章

**触发方式**: POST `/webhook/wechat-public-account-content`

**主要节点**:
- Webhook 接收请求
- 获取飞书多维表格数据
- DeepSeek 生成内容
- 内容处理和存储

### 02_图片生成

**功能**: 使用阿里云通义万相生成文章封面图和配图

**触发方式**: POST `/webhook/wechat-public-account-image`

**主要节点**:
- 提取图片提示词
- 调用通义万相 API
- 图片上传至飞书
- 更新多维表格

### 03_排版

**功能**: 将生成的内容按微信公众号格式排版

**触发方式**: POST `/webhook/wechat-public-account-typesetting`

**主要节点**:
- 获取文章内容
- HTML 格式转换
- 样式美化
- 生成排版结果

### 07_上传至微信草稿

**功能**: 将排版完成的内容上传至微信公众号草稿箱

**触发方式**: 手动触发或自动流程

**主要节点**:
- 获取飞书数据
- 微信 API 上传
- 草稿箱发布

## 🔧 常见问题

### Q1: 工作流导入失败怎么办？

确保 n8n 版本在 1.0 以上，部分旧版本可能不兼容。

### Q2: API 调用频率限制？

- DeepSeek: 根据套餐不同，建议添加等待节点
- 通义万相: 默认 QPS 限制，可在参数中调整

### Q3: 图片生成失败？

检查阿里云 DashScope API 密钥是否有效，以及账户余额是否充足。

## 📝 开发指南

### 添加新工作流

1. 在 n8n 中创建新工作流
2. 导出为 `.n8n` 文件
3. 放入 `workflows/` 目录
4. 更新本文档

### 修改现有工作流

1. 在 n8n 中编辑工作流
2. 测试通过后导出
3. 提交更新到 Git

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

1. Fork 本项目
2. 创建分支 (`git checkout -b feature/xxx`)
3. 提交更改 (`git commit -m 'Add xxx'`)
4. 推送到分支 (`git push origin feature/xxx`)
5. 创建 Pull Request

## 📄 许可证

本项目基于 MIT 许可证开源 - 查看 [LICENSE](./LICENSE) 文件了解详情。

## 🙏 致谢

- [n8n](https://n8n.io/) - 强大的工作流自动化工具
- [DeepSeek](https://deepseek.com/) - 高性能 AI 模型
- [阿里云通义万相](https://dashscope.aliyuncs.com/) - AI 图像生成服务
- [飞书](https://www.feishu.cn/) - 企业协作平台

---

如果你觉得这个项目对你有帮助，欢迎 ⭐ Star！
